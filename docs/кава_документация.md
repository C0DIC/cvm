# Кава

Кава это `ассемблер` для виртуальной машины (Виртуальная Машина Ката)

## **Инструкции**

Одна линия **кода** это одна **инструкция**, за исключением пустых и закомментированных строк.

Есть 2 типа инструкций: `с аргументами` и `без аргументов`.

Пример инструкций `с аргументами`:

- [push](#push)
- [goto](#goto)
- [cmp](#cmp)
- и тд.

Пример инструкций `без аргументов`:

- [add](#add)
- [hlt](#hlt)
- [sub](#sub)
- и тд.

### push

Позволяет добавить элемент в конец стэка.
*Выдает ошибку, если стэк переполнен*

``` text
push (i64 | f64 | string)
```

``` nasm
push 10
push "str"
push 1.43
```

### scn

Позволяет принимать ввод от пользователя через стандартный вход.

*См. [проблему #4](https://github.com/C0DIC/cvm/issues/4)*

``` text
scn
```

``` nasm
scn

wrtn i64    // Выведет то число, которое введет пользователь
```

### pop

Удаляет последний элемент в стэке.
*Выдает ошибку, если стэк пустой*

``` nasm
push 5
pop    // Удаляет 5, стэк теперь пустой
```

### add

Складывает 2 последних элемента.
*Выдает ошибку, если размер стэка меньше 2-х*

``` nasm
push 10
push 20    // Теперь размер стэка 2
add        // 10 + 10. Размер стэка теперь 1, а элемент стэка 20
```

### sub

Вычитает последний элемент из того, что на шаг над ним
*Выдает ошибку, если размер стэка меньше 2-х*

``` nasm
push 5
push 10    // Размер стэка теперь 2
sub        // 5 - 10. Размер теперь 1, а элемент -5
```

### mult

Умножает 2 последних элемента
*Выдает ошибку, если размер стэка меньше 2-х*

``` nasm
push 5
push 10    // Размер стэка теперь 2
mult       // 5 * 10. Размер теперь 1, а элемент 50
```

### div

Делит элемент на шаг выше последнего на него.
*Выдает ошибку, если размер стэка меньше 2-х*

``` nasm
push 35
push 5    // Размер стэка теперь 2
div       // 35 / 5. Размер стэка теперь 1, а элемент 7
```

### mod

Получение остатка от деления элемента на шаг выше последнего на него.
*Выдает ошибку, если размер стэка меньше 2-х*

``` nasm
push 36
push 5    // Размер стэка теперь 2
mod       // 36 % 5. Размер стэка теперь 1, а элемент 1
```

### wrt

Вывод последнего элемента стэка в стандартный выход.
*Выдает ошибку, если нечего вывести или стэк пустой*

```text
wrt (str | i64 | f64)
```

``` nasm
push 56
wrt i64               // Выведет 56
push "привет, мир!"
wrt str               // Выведет "привет, мир!"
```

### wrtn

Вывод последнего элемента стэка в стандартный выход с переносом на новую строку.
*Выдает ошибку, если нечего вывести или стэк пустой*

```text
wrtn (str | i64 | f64)
```

``` nasm
push 56
wrtn i64               // Выведет 56
push "привет, мир!"
wrtn str               // Выведет "привет, мир!"
```

### hlt

Немедленно останавливает работу виртуальной машины. Как `exit()` в Си или Пайтоне.

``` nasm
hlt
push 5       // Мертвый код. Машина до него не дойдет
```

### goto

"Перепрыгивание" с инструкции на инструкцию при помощи индекса или названий блоков.

- Инструкции - строчки кода, где есть настоящие инструкции
- Пустые строки и комментарии не учитываются (не берутся за строку)
- Счёт инструкций начинается с 0

*См. [проблему #2](https://github.com/C0DIC/cvm/issues/2)*

``` text
goto (int | название блока)
```

``` nasm
goto 5      // goto с индексами



push 2     // 5-ая строка
push 5
mult
wrtn i64
```

``` nasm
goto main    // Блочный goto

exit:
    hlt

main:
    push 5
    push 5
    add
    wrtn i64
```

### dup

Дублирует элемента на N шагов от последнего элемента.

- Счет шагов начинается с 0

*Выдает ошибку, если аргумент больше, чем размер стэка.*

``` text
dup (int)
```

``` nasm
push 90    // dup 1
push 45    // dup 0

// Дублируй элемент на 1 шаг от последнего элемента
dup 1      // Дублирует 90. Теперь размер стэка - 3
```

### swp

Меняет последний элемент стэка с элементов по индексу.

- Счет элементов начинается c 0

*Выдает ошибку, если аргумент меньше или больше размера стэка.*

``` text
swp (int)
```

``` nasm
push 45   // 0-ой элемент стэка
push 40   // 1-ый элемент стэка

swp 0     // 40 и 45 поменялись местами
```

### dmp

Выводит весь стэк в стандартный вывод в удобном формате.

``` nasm
push 5
push 9.6
push "Текст"

dmp
```

## Условия

### if

Если последний элемент равен аргументу - возвращает истину, в ином случае - ложь.

``` text
if (int)
```

``` nasm
push 1

if 1    // Если последний элемент 1
    wrtn i64   // Выведи это
hlt     // Иначе - отключайся
```

### ifnt

Если последний элемент не равен аргумент - возвращает истину, в ином случае - ложь.

*То же, что и `if not` в Пайтон и тд.*

``` text
ifnt (int)
```

``` nasm
.true  "Не 5"
.false "Это 5"

scn

ifnt 5     // Если последний элемент не 5
    wrtn $true   // Выведи "Не 5"
hlt        // Иначе - отключайся
```

### cmp

Если последний элемент равен элементу по индексу аргумента - возвращает истину,  иначе - ложь.

``` text
cmp (int)
```

``` nasm
push 5
push 1
push 5

cmp 0    // Если последний элемент равен 0-му элементу стэка
    wrtn i64   // Выведи его
hlt      // Иначе - отключайся
```

### Сравнения <, >, <=, >=, =\=, !=

Сравнивают элемент на шаг выше последнего с ним.

- Если условие верно, в стэк добавляется `1`, в ином случае `0`
- Стоит учитывать порядок элементов

Операторы сравнения используются в [max.cava](https://github.com/C0DIC/cvm/blob/main/examples/10-max.cava)

``` nasm
.tr "Правда"
.fl "Ложь"

push 3      // Если число будет больше 9, вернет ложь
push 9

// Все числа, которые меньше или равны 9 вернут истину
<=
if 1
    goto true
goto false

true:
    wrtn $tr
    hlt

false:
    wrtn $fl
    hlt
```

Смотрите также:

- Наименования
- Переменные

## Переменные

Переменные создаются при помощи `.`

*См. [проблему #5](https://github.com/C0DIC/cvm/issues/5)*

``` text
.{название переменной} {значение}
```

``` nasm
.int_var 5
.float_var 6.4
.string_var "Привет"
```

Доступ осуществляется при помощи `$`

``` nasm
.five 5

wrtn $five  // Выведет 5
```

## Наименовая

Можно разделять код на блоки при помощи наименований.

``` text
{название блока}:
```

``` nasm
goto main    // Перепрыгнет на блок `main`

exit:        // Блок пропустится, потому что мы прыгнули в `main`
    hlt

main:
    push -15
    wrtn i64     // Выведет -15
    push 50
    wrtn i64     // Выведет 50
```

## Комментарии

Комментарии начинаются с `//`

``` nasm
// Это комментарий
hlt   // Это тоже комментарий
```
